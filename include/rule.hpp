#ifndef RULE
#define RULE

#include <array>
#include <cstdint>
#include <vector>

namespace rule
{
    typedef enum
    {
        I,
        J,
        L,
        O,
        S,
        T,
        Z,
        G,
        A
    } piece;
    typedef enum
    {
        INP_L,
        INP_R,
        INP_D,
        INP_CR,
        INP_CD,
        INP_CL
    } input;
    typedef enum
    {
        DIR_U,
        DIR_R,
        DIR_D,
        DIR_L
    } direction;

    using mask = uint64_t;
    using offset = int32_t;
    using queue = std::vector<piece>;
    using kicktable = std::vector<offset>;
    using masktable = std::vector<mask>;
    template <typename T>
    using piecedata = std::array<std::array<T, 4>, 7>;
    struct pcstate
    {
        mask board;
        int lines;
    };
    struct piecestate
    {
        piece pc;
        direction dir;
        offset os;
    };
    struct inputallowed
    {
        mask l_mask;
        mask r_mask;
        mask d_mask;
        std::vector<mask> cr_mask;
        std::vector<mask> cd_mask;
        std::vector<mask> cl_mask;
    };

    inline const int height = 6;
    inline const int width = 10;
    inline const mask fullrow = (1 << width) - 1;
    const piecedata<mask> piecemasks = {{{{15, 1074791425, 15, 1074791425}},
                                         {{1031, 3146753, 7172, 2099203}},
                                         {{4103, 1049603, 7169, 3147778}},
                                         {{3075, 3075, 3075, 3075}},
                                         {{6147, 1051650, 6147, 1051650}},
                                         {{2055, 1051649, 7170, 2100226}},
                                         {{3078, 2100225, 3078, 2100225}}}};
    const piecedata<std::array<offset, 4>> minooffsets = {{{{{{0, 1, 2, 3}},
                                                             {{0, 10, 20, 30}},
                                                             {{0, 1, 2, 3}},
                                                             {{0, 10, 20, 30}}}},
                                                           {{{{0, 1, 2, 10}},
                                                             {{0, 10, 20, 21}},
                                                             {{2, 10, 11, 12}},
                                                             {{0, 1, 11, 21}}}},
                                                           {{{{0, 1, 2, 12}},
                                                             {{0, 1, 10, 20}},
                                                             {{0, 10, 11, 12}},
                                                             {{1, 11, 20, 21}}}},
                                                           {{{{0, 1, 10, 11}},
                                                             {{0, 1, 10, 11}},
                                                             {{0, 1, 10, 11}},
                                                             {{0, 1, 10, 11}}}},
                                                           {{{{0, 1, 11, 12}},
                                                             {{1, 10, 11, 20}},
                                                             {{0, 1, 11, 12}},
                                                             {{1, 10, 11, 20}}}},
                                                           {{{{0, 1, 2, 11}},
                                                             {{0, 10, 11, 20}},
                                                             {{1, 10, 11, 12}},
                                                             {{1, 10, 11, 21}}}},
                                                           {{{{1, 2, 10, 11}},
                                                             {{0, 10, 11, 21}},
                                                             {{1, 2, 10, 11}},
                                                             {{0, 10, 11, 21}}}}}};
    const std::array<offset, 7> spawnoffsets = {{53, 53, 53, 54, 53, 53, 53}};
    const std::array<piecedata<mask>, 5> spawnmasks = {{{{{{143129062644251775, 1152921504606846975, 143129062644251775, 1152921504606846975}},
                                                          {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                                          {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                                          {{575897252056792575, 575897252056792575, 575897252056792575, 575897252056792575}},
                                                          {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                                          {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                                          {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}}}},
                                                        {{{{143129062644251648, 1152921504606845952, 143129062644251648, 1152921504606845952}},
                                                          {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                                          {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                                          {{575897252056792064, 575897252056792064, 575897252056792064, 575897252056792064}},
                                                          {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                                          {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                                          {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}}}},
                                                        {{{{143129062644121600, 1152921504605798400, 143129062644121600, 1152921504605798400}},
                                                          {{287385125781504000, 575897252056268800, 287385125781504000, 575897252056268800}},
                                                          {{287385125781504000, 575897252056268800, 287385125781504000, 575897252056268800}},
                                                          {{575897252056268800, 575897252056268800, 575897252056268800, 575897252056268800}},
                                                          {{287385125781504000, 575897252056268800, 287385125781504000, 575897252056268800}},
                                                          {{287385125781504000, 575897252056268800, 287385125781504000, 575897252056268800}},
                                                          {{287385125781504000, 575897252056268800, 287385125781504000, 575897252056268800}}}},
                                                        {{{{143129062510952448, 1152921503533105152, 143129062510952448, 1152921503533105152}},
                                                          {{287385125514117120, 575897251520446464, 287385125514117120, 575897251520446464}},
                                                          {{287385125514117120, 575897251520446464, 287385125514117120, 575897251520446464}},
                                                          {{575897251520446464, 575897251520446464, 575897251520446464, 575897251520446464}},
                                                          {{287385125514117120, 575897251520446464, 287385125514117120, 575897251520446464}},
                                                          {{287385125514117120, 575897251520446464, 287385125514117120, 575897251520446464}},
                                                          {{287385125514117120, 575897251520446464, 287385125514117120, 575897251520446464}}}},
                                                        {{{{143128926145740800, 1152920405095219200, 143128926145740800, 1152920405095219200}},
                                                          {{287384851709952000, 575896702838374400, 287384851709952000, 575896702838374400}},
                                                          {{287384851709952000, 575896702838374400, 287384851709952000, 575896702838374400}},
                                                          {{575896702838374400, 575896702838374400, 575896702838374400, 575896702838374400}},
                                                          {{287384851709952000, 575896702838374400, 287384851709952000, 575896702838374400}},
                                                          {{287384851709952000, 575896702838374400, 287384851709952000, 575896702838374400}},
                                                          {{287384851709952000, 575896702838374400, 287384851709952000, 575896702838374400}}}}}};
    const piecedata<mask> existmasks = {{{{143129062644251775, 1152921504606846975, 143129062644251775, 1152921504606846975}},
                                         {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                         {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                         {{575897252056792575, 575897252056792575, 575897252056792575, 575897252056792575}},
                                         {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                         {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}},
                                         {{287385125781765375, 575897252056792575, 287385125781765375, 575897252056792575}}}};
    const std::array<piecedata<mask>, 5> placementmasks = {{{{{{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}}}},
                                                            {{{{127, 0, 127, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}},
                                                              {{0, 0, 0, 0}}}},
                                                            {{{{130175, 0, 130175, 0}},
                                                              {{255, 0, 255, 0}},
                                                              {{255, 0, 255, 0}},
                                                              {{511, 511, 511, 511}},
                                                              {{255, 0, 255, 0}},
                                                              {{255, 0, 255, 0}},
                                                              {{255, 0, 255, 0}}}},
                                                            {{{{133299327, 0, 133299327, 0}},
                                                              {{261375, 511, 261375, 511}},
                                                              {{261375, 511, 261375, 511}},
                                                              {{523775, 523775, 523775, 523775}},
                                                              {{261375, 511, 261375, 511}},
                                                              {{261375, 511, 261375, 511}},
                                                              {{261375, 511, 261375, 511}}}},
                                                            {{{{136498510975, 1023, 136498510975, 1023}},
                                                              {{267648255, 523775, 267648255, 523775}},
                                                              {{267648255, 523775, 267648255, 523775}},
                                                              {{536346111, 536346111, 536346111, 536346111}},
                                                              {{267648255, 523775, 267648255, 523775}},
                                                              {{267648255, 523775, 267648255, 523775}},
                                                              {{267648255, 523775, 267648255, 523775}}}}}};

    const offset l_offset = -1;
    const offset r_offset = 1;
    const offset d_offset = -10;
    const piecedata<kicktable> cr_offsets = {{{{{{-18, -20, -17, -30, 3}},
                                                {{8, 7, 10, 27, 0}},
                                                {{-9, -7, -10, 3, -30}},
                                                {{19, 20, 17, 0, 27}}}},
                                              {{{{-9, -10, 0, -29, -30}},
                                                {{-1, 0, -10, 19, 20}},
                                                {{0, 1, 11, -20, -19}},
                                                {{10, 9, -1, 30, 29}}}},
                                              {{{{-9, -10, 0, -29, -30}},
                                                {{-1, 0, -10, 19, 20}},
                                                {{0, 1, 11, -20, -19}},
                                                {{10, 9, -1, 30, 29}}}},
                                              {{{{}}, {{}}, {{}}, {{}}}},
                                              {{{{-9, -10, 0, -29, -30}},
                                                {{-1, 0, -10, 19, 20}},
                                                {{0, 1, 11, -20, -19}},
                                                {{10, 9, -1, 30, 29}}}},
                                              {{{{-9, -10, 0, -30}},
                                                {{-1, 0, -10, 19, 20}},
                                                {{0, 1, -20, -19}},
                                                {{10, 9, -1, 30, 29}}}},
                                              {{{{-9, -10, 0, -29, -30}},
                                                {{-1, 0, -10, 19, 20}},
                                                {{0, 1, 11, -20, -19}},
                                                {{10, 9, -1, 30, 29}}}}}};
    const piecedata<kicktable> cd_offsets = {{
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
        {{{{}}, {{}}, {{}}, {{}}}},
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
        {{{{-10, 0}},
          {{-1, 0}},
          {{10, 0}},
          {{1, 0}}}},
    }};
    const piecedata<kicktable> cl_offsets = {{{{{{-19, -20, -17, 0, -27}},
                                                {{18, 20, 17, 30, -3}},
                                                {{-8, -7, -10, -27, 0}},
                                                {{9, 7, 10, -3, 30}}}},
                                              {{{{-10, -9, 1, -30, -29}},
                                                {{9, 10, 0, 29, 30}},
                                                {{1, 0, 10, -19, -20}},
                                                {{0, -1, -11, 20, 19}}}},
                                              {{{{-10, -9, 1, -30, -29}},
                                                {{9, 10, 0, 29, 30}},
                                                {{1, 0, 10, -19, -20}},
                                                {{0, -1, -11, 20, 19}}}},
                                              {{{{}}, {{}}, {{}}, {{}}}},
                                              {{{{-10, -9, 1, -30, -29}},
                                                {{9, 10, 0, 29, 30}},
                                                {{1, 0, 10, -19, -20}},
                                                {{0, -1, -11, 20, 19}}}},
                                              {{{{-10, -9, 1, -29}},
                                                {{9, 10, 0, 29, 30}},
                                                {{1, 0, -19, -20}},
                                                {{0, -1, -11, 20, 19}}}},
                                              {{{{-10, -9, 1, -30, -29}},
                                                {{9, 10, 0, 29, 30}},
                                                {{1, 0, 10, -19, -20}},
                                                {{0, -1, -11, 20, 19}}}}}};

    const piecedata<mask> l_allowed = {{{{142002062150989950, 1151794504113585150, 142002062150989950, 1151794504113585150}},
                                        {{286258125288503550, 574770251563530750, 286258125288503550, 574770251563530750}},
                                        {{286258125288503550, 574770251563530750, 286258125288503550, 574770251563530750}},
                                        {{574770251563530750, 574770251563530750, 574770251563530750, 574770251563530750}},
                                        {{286258125288503550, 574770251563530750, 286258125288503550, 574770251563530750}},
                                        {{286258125288503550, 574770251563530750, 286258125288503550, 574770251563530750}},
                                        {{286258125288503550, 574770251563530750, 286258125288503550, 574770251563530750}}}};
    const piecedata<mask> r_allowed = {{{{71001031075494975, 575897252056792575, 71001031075494975, 575897252056792575}},
                                        {{143129062644251775, 287385125781765375, 143129062644251775, 287385125781765375}},
                                        {{143129062644251775, 287385125781765375, 143129062644251775, 287385125781765375}},
                                        {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781765375}},
                                        {{143129062644251775, 287385125781765375, 143129062644251775, 287385125781765375}},
                                        {{143129062644251775, 287385125781765375, 143129062644251775, 287385125781765375}},
                                        {{143129062644251775, 287385125781765375, 143129062644251775, 287385125781765375}}}};
    const piecedata<mask> d_allowed = {{{{143129062644251648, 1152921504606845952, 143129062644251648, 1152921504606845952}},
                                        {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                        {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                        {{575897252056792064, 575897252056792064, 575897252056792064, 575897252056792064}},
                                        {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                        {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}},
                                        {{287385125781765120, 575897252056792064, 287385125781765120, 575897252056792064}}}};
    const piecedata<masktable> cr_allowed = {{{{{{143129062644121600, 143129062644121600, 143129062644121600, 143129062510952448, 143129062644251775}},
                                                {{572516250577007100, 1145032501154014200, 143129062644251775, 1145032501154014200, 143129062644251775}},
                                                {{143129062644251648, 143129062644251648, 143129062644251648, 143129062644251775, 143129062510952448}},
                                                {{286258125288503550, 143129062644251775, 1145032501154014200, 143129062644251775, 1145032501154014200}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765120, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530750, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765120, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530750, 287385125781765375, 574770251563530750}}}},
                                              {{{{}},
                                                {{}},
                                                {{}},
                                                {{}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765120, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530750, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765120, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530750, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765120, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530750, 287385125781765375, 574770251563530750}}}}}};
    const piecedata<masktable> cd_allowed = {{{{{{143129062644251648, 143129062644251775}},
                                                {{1151794504113585150, 1152921504606846975}},
                                                {{143129062644251775, 143129062644251775}},
                                                {{575897252056792575, 1152921504606846975}}}},
                                              {{{{287385125781765120, 287385125781765375}},
                                                {{574770251563530750, 575897252056792575}},
                                                {{287385125781765375, 287385125781765375}},
                                                {{287385125781765375, 575897252056792575}}}},
                                              {{{{287385125781765120, 287385125781765375}},
                                                {{574770251563530750, 575897252056792575}},
                                                {{287385125781765375, 287385125781765375}},
                                                {{287385125781765375, 575897252056792575}}}},
                                              {{{{}},
                                                {{}},
                                                {{}},
                                                {{}}}},
                                              {{{{287385125781765120, 287385125781765375}},
                                                {{574770251563530750, 575897252056792575}},
                                                {{287385125781765375, 287385125781765375}},
                                                {{287385125781765375, 575897252056792575}}}},
                                              {{{{287385125781765120, 287385125781765375}},
                                                {{574770251563530750, 575897252056792575}},
                                                {{287385125781765375, 287385125781765375}},
                                                {{287385125781765375, 575897252056792575}}}},
                                              {{{{287385125781765120, 287385125781765375}},
                                                {{574770251563530750, 575897252056792575}},
                                                {{287385125781765375, 287385125781765375}},
                                                {{287385125781765375, 575897252056792575}}}}}};
    const piecedata<masktable> cl_allowed = {{{{{{143129062644121600, 143129062644121600, 143129062644121600, 143129062644251775, 143129062510952448}},
                                                {{572516250577007100, 143129062644251775, 1145032501154014200, 143129062644251775, 1145032501154014200}},
                                                {{143129062644251648, 143129062644251648, 143129062644251648, 143129062510952448, 143129062644251775}},
                                                {{286258125288503550, 1145032501154014200, 143129062644251775, 1145032501154014200, 143129062644251775}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765375, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530240, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765375, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530240, 287385125781765375, 574770251563530750}}}},
                                              {{{{}},
                                                {{}},
                                                {{}},
                                                {{}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765375, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530240, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765375, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530240, 287385125781765375, 574770251563530750}}}},
                                              {{{{287385125781765120, 287385125781765120, 287385125781765375, 287385125514117120, 287385125514117120}},
                                                {{574770251563530750, 287385125781765375, 287385125781765375, 574770251563530750, 287385125781765375}},
                                                {{287385125781765375, 287385125781765375, 287385125781765375, 287385125781504000, 287385125781504000}},
                                                {{287385125781765375, 574770251563530750, 574770251563530240, 287385125781765375, 574770251563530750}}}}}};
}

#endif